<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RedZone Topup</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(120deg, #0d0d0d, #1c1c1c);
      color: #fff;
      text-align: center;
      overflow-x: hidden;
      animation: pulseGlow 10s infinite;
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 20px red; }
      50% { box-shadow: 0 0 40px #ff4c4c; }
    }

    .logo {
      width: 120px;
      filter: drop-shadow(0 0 8px red);
      cursor: pointer;
      margin-top: 10px;
    }

    .title {
      font-size: 2.5rem;
      color: #ff4c4c;
      text-shadow: 0 0 15px white;
      margin: 5px 0 20px;
    }

    .status {
      font-size: 14px;
      margin-bottom: 20px;
      color: #ddd;
    }

    .status span {
      color: #00ff00;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }

    .section {
      background: #1c1c1c;
      border: 1px solid #ff4c4c;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      max-width: 700px;
      box-shadow: 0 0 15px #ff000066;
    }

    h3 {
      color: #ff4c4c;
      text-shadow: 0 0 5px #fff;
    }

    .stars {
      font-size: 28px;
      margin: 5px;
      color: #555;
      cursor: pointer;
      transition: color 0.2s;
    }

    .stars.active {
      color: #ffcc00;
    }

    textarea {
      width: 90%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      background: #2a2a2a;
      color: #fff;
      border: none;
      resize: none;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #ff4c4c;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #ff1a1a;
    }

    .average-rating {
      margin-top: 10px;
      font-size: 18px;
      color: #ffcc00;
    }

    .review-list {
      text-align: left;
      max-height: 300px;
      overflow-y: auto;
      padding: 0 10px;
    }

    .review-item {
      background: #2c2c2c;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      box-shadow: 0 0 10px #ff4c4c55;
    }

    .review-date {
      font-size: 12px;
      color: #ccc;
    }

    .product-list p {
      margin: 5px 0;
    }

    .insta {
      margin-top: 30px;
      cursor: pointer;
      filter: drop-shadow(0 0 6px white);
    }

    #spinner {
      display: none;
      margin-top: 10px;
    }

    @media (max-width: 480px) {
      .section {
        padding: 15px;
      }

      .logo {
        width: 100px;
      }

      .stars {
        font-size: 24px;
      }
    }

    .review-comment.collapsed {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.3s ease;
      padding: 0;
      margin: 0;
    }

    .review-comment {
      max-height: 100px;
      opacity: 1;
      transition: all 0.3s ease;
      margin-top: 5px;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <audio id="ding-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b92e8755e.mp3?filename=notification-5-21466.mp3" preload="auto"></audio>

  <img src="https://www.example.com/logo.png" class="logo" onclick="window.open('https://www.instagram.com/redzone_topup', '_blank')" />
  <div class="title">RedZone Topup</div>
  <div class="status">ร้านเปิด <strong>24 ชม.</strong> | สถานะ: <span>● ออนไลน์</span> | แอดมิน: 1 คน</div>

  <div class="section">
    <h3>รีวิวร้าน</h3>
    <div id="star-container">
      <span class="stars" data-rating="1">★</span>
      <span class="stars" data-rating="2">★</span>
      <span class="stars" data-rating="3">★</span>
      <span class="stars" data-rating="4">★</span>
      <span class="stars" data-rating="5">★</span>
    </div>
    <textarea id="comment" rows="3" placeholder="แสดงความคิดเห็นของคุณ..."></textarea>
    <button id="submit-btn">ส่งรีวิว</button>
    <div id="spinner">กำลังโหลดรีวิว...</div>
    <div class="average-rating">คะแนนเฉลี่ย: <span id="average">-</span></div>
    <div class="count">จำนวนผู้รีวิวทั้งหมด: <span id="review-count">0</span></div>
  </div>

  <div class="section">
    <h3>รีวิวล่าสุด</h3>
    <div class="review-list" id="review-list"></div>
  </div>

  <div class="section">
    <h3>รายการสินค้า</h3>
    <div class="product-list">
      <p><strong>RoV</strong> (Garena คูปอง)</p>
      <p>• 50฿ → 51 คูปอง</p>
      <p>• 90฿ → 96 คูปอง</p>
      <p>• 150฿ → 160 คูปอง</p>
      <p>• 300฿ → 325 คูปอง</p>
      <p>• 1,000฿ → ~1,200 คูปอง</p>
      <hr/>
      <p><strong>Minecraft</strong></p>
      <p>• Java / Bedrock ~580฿</p>
      <p>• Minecoins 1,720: ~296฿</p>
      <p>• Minecoins 3,500: ~587฿</p>
      <hr/>
      <p><strong>Roblox</strong></p>
      <p>• 400 Robux: ~179฿</p>
      <p>• 800 Robux: ~359฿</p>
      <p>• 1,700 Robux: ~719฿</p>
      <p>• Premium เริ่มที่ ~179฿/เดือน</p>
      <hr/>
      <p><strong>TrueMoney Wallet</strong></p>
      <p>• เติมตามยอดจริง 50฿, 100฿, 500฿</p>
      <p>• ค่าธรรมเนียมตามช่องทาง</p>
    </div>
  </div>

  <img class="insta" src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" width="40" onclick="window.open('https://www.instagram.com/redzone_topup', '_blank')" />

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBxO_iCEiXDTdg_90bUkvqv6S4a3Mk9070",
    authDomain: "redzone-topup-852a2.firebaseapp.com",
    projectId: "redzone-topup-852a2",
    storageBucket: "redzone-topup-852a2.appspot.com",
    messagingSenderId: "209606560486",
    appId: "1:209606560486:web:d12baa8545d99adad14927"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  let selectedRating = 0;
  let submitting = false;

  function updateStarDisplay(rating) {
    document.querySelectorAll('.stars').forEach(star => {
      const value = parseInt(star.dataset.rating);
      if (value <= rating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
  }

  async function submitReview() {
    if (submitting) return;
    submitting = true;

    if (selectedRating === 0) {
      alert("กรุณาเลือกดาวก่อนรีวิว");
      submitting = false;
      return;
    }

    const comment = document.getElementById('comment').value.trim();
    if (!comment) {
      alert("กรุณากรอกความคิดเห็นก่อนส่งรีวิว");
      submitting = false;
      return;
    }

    try {
      await db.collection("reviews").add({
        rating: selectedRating,
        comment: comment,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById('ding-sound').play();
      selectedRating = 0;
      updateStarDisplay(0);
      document.getElementById('comment').value = '';
      alert("ขอบคุณสำหรับรีวิวของคุณ!");
      loadReviews();
    } catch (err) {
      alert("เกิดข้อผิดพลาดในการส่งรีวิว");
    }

    submitting = false;
  }

  function toggleReview(id) {
    const el = document.getElementById(id);
    el?.classList.toggle("collapsed");
  }

  function loadReviews() {
    const spinner = document.getElementById("spinner");
    spinner.style.display = "block";

    db.collection("reviews").orderBy("timestamp", "desc").get().then(snapshot => {
      let html = '';
      let total = 0, count = 0;

      snapshot.forEach((doc, index) => {
        const data = doc.data();
        const time = data.timestamp?.toDate().toLocaleString('th-TH') || '';
        const reviewId = `review-${doc.id}`;
        const comment = data.comment || "";

        html += `
          <div class="review-item" onclick="toggleReview('${reviewId}')">
            <div><strong>Member ${index + 1}</strong></div>
            <div>คะแนน: ${'★'.repeat(data.rating)}</div>
            <div class="review-date">${time}</div>
            <div class="review-comment collapsed" id="${reviewId}">
              <div style="margin-top:5px;">"${comment}"</div>
            </div>
          </div>
        `;

        total += data.rating;
        count++;
      });

      document.getElementById("review-list").innerHTML = html;
      document.getElementById("review-count").innerText = count;
      document.getElementById("average").innerText = count ? (total / count).toFixed(2) : "-";
      spinner.style.display = "none";
    }).catch(() => {
      spinner.style.display = "none";
      alert("เกิดข้อผิดพลาดในการโหลดรีวิว");
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.stars').forEach(star => {
      star.addEventListener('click', () => {
        selectedRating = parseInt(star.dataset.rating);
        updateStarDisplay(selectedRating);
      });
    });

    document.getElementById("submit-btn").addEventListener("click", submitReview);
    loadReviews();
  });
</script>
</body>
</html>