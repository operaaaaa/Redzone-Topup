<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รีวิวร้าน RedZone Topup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            width: 150px;
            margin-bottom: 20px;
            cursor: pointer;
            filter: brightness(0) invert(1);
        }
        .reviews {
            margin-top: 20px;
            background-color: #1f1f1f;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .reviews h3 {
            margin-bottom: 10px;
            color: #ff4c4c;
            text-shadow: 1px 1px 5px #fff;
        }
        .stars {
            font-size: 25px;
            color: #ffcc00;
            cursor: pointer;
        }
        .stars:hover {
            color: #ff4c4c;
        }
        .comment-box {
            margin-top: 10px;
            padding: 10px;
            width: 100%;
            background-color: #2a2a2a;
            border-radius: 5px;
            color: #fff;
        }
        .average-rating {
            font-size: 18px;
            margin-top: 10px;
        }
        .review-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: scroll;
        }
        .review-item {
            background-color: #333;
            margin: 5px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .review-date {
            font-size: 12px;
            color: #bbb;
        }
        .review-comment {
            margin-top: 10px;
            font-size: 14px;
            color: #fff;
        }
        .submit-btn {
            background-color: #ff4c4c;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #ff6666;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
</head>
<body>

    <header>
        <h2 style="color: #ff4c4c; text-shadow: 1px 1px 5px #fff;">รีวิวร้าน RedZone Topup</h2>
        <img src="https://www.example.com/logo.png" alt="ร้าน Logo" class="logo" onclick="window.location.href='https://www.instagram.com/redzone_topup?igsh=MXY1Z3FidjFnbmVlOA%3D%3D&utm_source=qr'">
    </header>

    <div class="reviews">
        <h3>กรุณากดรีวิวร้าน</h3>
        <div class="stars" onclick="submitReview(5)">★★★★★</div>
        <div class="stars" onclick="submitReview(4)">★★★★☆</div>
        <div class="stars" onclick="submitReview(3)">★★★☆☆</div>
        <div class="stars" onclick="submitReview(2)">★★☆☆☆</div>
        <div class="stars" onclick="submitReview(1)">★☆☆☆☆</div>

        <textarea id="comment" class="comment-box" placeholder="เพิ่มคอมเม้นท์ของคุณที่นี่..."></textarea>
        <button class="submit-btn" onclick="submitReview()">ส่งรีวิว</button>
        <p class="average-rating">คะแนนเฉลี่ย: <span id="average-rating">กำลังคำนวณ...</span></p>
    </div>

    <div class="review-list">
        <h3>รีวิวทั้งหมด</h3>
        <div id="reviews"></div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBxO_iCEiXDTdg_90bUkvqv6S4a3Mk9070",
            authDomain: "redzone-topup-852a2.firebaseapp.com",
            projectId: "redzone-topup-852a2",
            storageBucket: "redzone-topup-852a2.firebasestorage.app",
            messagingSenderId: "209606560486",
            appId: "1:209606560486:web:d12baa8545d99adad14927",
            measurementId: "G-T1WWTKDY79"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // ฟังก์ชันเพื่อบันทึกรีวิวจากลูกค้า
        function submitReview(rating) {
            const comment = document.getElementById("comment").value;
            const reviewRef = db.collection('reviews');
            const newReview = {
                rating: rating,
                comment: comment,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            // บันทึกรีวิวลงใน Firestore
            reviewRef.add(newReview)
                .then(() => {
                    console.log("รีวิวถูกบันทึกสำเร็จ");
                    document.getElementById("comment").value = ''; // ล้างช่องคอมเม้นท์
                    // หลังจากบันทึกรีวิว ให้รีเฟรชข้อมูลรีวิว
                    loadReviews();
                })
                .catch((error) => {
                    console.error("Error adding review: ", error);
                });
        }

        // ฟังก์ชันในการโหลดรีวิวทั้งหมด
        function loadReviews() {
            const reviewRef = db.collection('reviews');
            reviewRef.orderBy('timestamp', 'desc').get()
                .then((querySnapshot) => {
                    let reviewsHTML = '';
                    let totalRating = 0;
                    let reviewCount = querySnapshot.size;

                    querySnapshot.forEach((doc) => {
                        const review = doc.data();
                        const date = new Date(review.timestamp.seconds * 1000).toLocaleString();
                        reviewsHTML += `<div class="review-item">
                                            <div>คะแนน: ${"★".repeat(review.rating)}</div>
                                            <p class="review-comment">${review.comment}</p>
                                            <p class="review-date">รีวิวเมื่อ: ${date}</p>
                                          </div>`;
                        totalRating += review.rating;
                    });

                    // คำนวณคะแนนเฉลี่ย
                    const averageRating = totalRating / reviewCount;
                    document.getElementById("average-rating").textContent = averageRating.toFixed(2);

                    // แสดงรีวิว
                    document.getElementById("reviews").innerHTML = reviewsHTML;
                })
                .catch((error) => {
                    console.error("Error getting reviews: ", error);
                });
        }

        // โหลดรีวิวเมื่อหน้าเว็บถูกโหลด
        window.onload = loadReviews;
    </script>
</body>
</html>