<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบรีวิวและการสั่งซื้อ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            width: 150px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        h2 {
            color: #333;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            width: 200px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            padding: 10px 20px;
            background-color: #ff5722;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #e64a19;
        }
        .stars {
            display: inline-block;
        }
        .stars span {
            font-size: 30px;
            cursor: pointer;
            color: #ccc;
        }
        .stars span.selected {
            color: gold;
        }
        .status {
            color: #333;
            font-size: 16px;
            margin-top: 10px;
        }
        .order-history {
            margin-top: 20px;
        }
        #customerCount {
            font-size: 18px;
            margin-top: 20px;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
</head>
<body>

    <header>
        <a href="https://www.instagram.com/redzone_topup?igsh=MXY1Z3FidjFnbmVlOA%3D%3D&utm_source=qr" target="_blank">
            <img src="logo.png" alt="โลโก้ร้าน" class="logo">
        </a>
        <h2>ระบบรีวิวและการสั่งซื้อ</h2>
    </header>

    <!-- ส่วน Login สำหรับแอดมิน -->
    <div id="loginPage">
        <h3>Login Admin</h3>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Username">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">เข้าสู่ระบบ</button>
        <div id="loginStatus"></div>
    </div>

    <!-- หน้า รีวิวสำหรับลูกค้า -->
    <div id="reviewPage" style="display:none;">
        <h3>กรุณากรอกรหัสอ้างอิงและให้คะแนน</h3>
        <label for="refCodeInput">รหัสอ้างอิง:</label>
        <input type="text" id="refCodeInput" placeholder="กรอกรหัสอ้างอิง">
        
        <div class="stars" id="stars">
            <span data-value="1">☆</span>
            <span data-value="2">☆</span>
            <span data-value="3">☆</span>
            <span data-value="4">☆</span>
            <span data-value="5">☆</span>
        </div>
        
        <button onclick="submitReview()">ส่งรีวิว</button>
        <div id="reviewStatus"></div>

        <!-- ประวัติการสั่งซื้อ -->
        <div id="orderHistory" class="order-history"></div>

        <!-- แสดงจำนวนลูกค้าจริงที่รีวิว -->
        <div id="customerCount"></div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBxO_iCEiXDTdg_90bUkvqv6S4a3Mk9070",
            authDomain: "redzone-topup-852a2.firebaseapp.com",
            projectId: "redzone-topup-852a2",
            storageBucket: "redzone-topup-852a2.firebasestorage.app",
            messagingSenderId: "209606560486",
            appId: "1:209606560486:web:d12baa8545d99adad14927",
            measurementId: "G-T1WWTKDY79"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(app);

        // ฟังก์ชัน Login
        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            if (username === "admin" && password === "admin") {
                document.getElementById("loginPage").style.display = "none";
                document.getElementById("reviewPage").style.display = "block";
                fetchCustomerCount(); // ดึงจำนวนลูกค้าจริงที่รีวิว
            } else {
                document.getElementById("loginStatus").innerText = "ข้อมูลไม่ถูกต้อง";
            }
        }

        // ฟังก์ชันส่งรีวิว
        function submitReview() {
            const refCode = document.getElementById("refCodeInput").value;
            const rating = document.querySelector('.stars .selected') ? document.querySelector('.stars .selected').getAttribute('data-value') : null;

            if (refCode && rating) {
                db.collection("reviews").add({
                    refCode: refCode,
                    rating: rating,
                    createdAt: new Date(),
                    isFake: false // ให้ค่าคือ false สำหรับลูกค้าจริง
                }).then(() => {
                    document.getElementById("reviewStatus").innerText = "รีวิวของคุณถูกส่งแล้ว!";
                    fetchCustomerCount(); // รีเฟรชจำนวนลูกค้าจริงที่รีวิว
                }).catch((error) => {
                    console.error("Error adding review: ", error);
                    document.getElementById("reviewStatus").innerText = "เกิดข้อผิดพลาดในการส่งรีวิว";
                });
            } else {
                document.getElementById("reviewStatus").innerText = "กรุณากรอกรหัสอ้างอิงและให้คะแนน";
            }
        }

        // ฟังก์ชันให้ดาว
        document.querySelectorAll('.stars span').forEach(function(star) {
            star.addEventListener('click', function() {
                document.querySelectorAll('.stars span').forEach(function(star) {
                    star.classList.remove('selected');
                });
                star.classList.add('selected');
            });
        });

        // ฟังก์ชันนับจำนวนลูกค้าจริงที่รีวิว
        function fetchCustomerCount() {
            db.collection("reviews").where("isFake", "==", false).get()
            .then((querySnapshot) => {
                const customerCount = querySnapshot.size;
                document.getElementById("customerCount").innerText = `จำนวนลูกค้าจริงที่รีวิว: ${customerCount} คน`;
            })
            .catch((error) => {
                console.error("Error fetching reviews: ", error);
                document.getElementById("customerCount").innerText = "ไม่สามารถดึงข้อมูลลูกค้าจริงได้";
            });
        }

        // ฟังก์ชันสร้างลูกค้าปลอมๆ
        function generateFakeCustomers() {
            const fakeCustomers = [];
            const numCustomers = 2793; // จำนวนลูกค้า
            const ratingRange = [3, 5]; // ช่วงคะแนนดาวเฉลี่ยระหว่าง 3-5 ดาว

            for (let i = 0; i < numCustomers; i++) {
                const customer = {
                    name: `Customer ${i + 1}`,
                    refCode: generateRandomCode(),
                    rating: getRandomRating(ratingRange[0], ratingRange[1]),
                    orderHistory: generateOrderHistory(),
                    createdAt: new Date(),
                    isFake: true // ให้ค่าคือ true สำหรับลูกค้าปลอม
                };
                fakeCustomers.push(customer);
            }

            fakeCustomers.forEach(customer => {
                db.collection("reviews").add(customer)
                .then(() => {
                    console.log(`ลูกค้า ${customer.name} ถูกเพิ่มสำเร็จ`);
                }).catch((error) => {
                    console.error("Error adding customer: ", error);
                });
            });
        }

        // ฟังก์ชันสร้างรหัสอ้างอิงสุ่ม
        function generateRandomCode() {
            return "REF-" + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // ฟังก์ชันสุ่มคะแนนดาว
        function getRandomRating(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ฟังก์ชันสร้างประวัติการสั่งซื้อปลอมๆ
        function generateOrderHistory() {
            const orders = [
                { product: "RoV (Garena คูปอง)", amount: "50฿", quantity: 1 },
                { product: "Minecraft (Java Edition)", amount: "580฿", quantity: 1 },
                { product: "Roblox Premium", amount: "179฿", quantity: 1 },
                { product: "TrueMoney Wallet", amount: "100฿", quantity: 1 }
            ];

            const randomOrder = orders[Math.floor(Math.random() * orders.length)];
            return {
                product: randomOrder.product,
                amount: randomOrder.amount,
                quantity: randomOrder.quantity,
                orderDate: new Date()
            };
        }

        // เรียกใช้ฟังก์ชันเพื่อสร้างข้อมูลลูกค้าปลอมๆ
        generateFakeCustomers();
    </script>
</body>
</html>
